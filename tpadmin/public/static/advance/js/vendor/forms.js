function formInitial(){var e=$(".diagnose");if(e.length>0){var t={};t=e.offset();var r=e.width(),o=e.height();$(".form-diagnose").width(r),$(".form-inner-wrapper").css({"margin-left":r-o/2}),$(".form-outter-wrapper").css({top:t.top,left:t.left+o/2})}}function resizeForm(){var e=viewport().width,t="block"===$(".form-outter-wrapper").css("display");$(".form-outter-wrapper").removeAttr("style"),$(".form-inner-wrapper").removeAttr("style"),e>=768?t&&(formInitial(),$(".form-outter-wrapper").css({left:"10%",display:"block"})):($(".app-mask").removeClass().addClass("app-mask").hide(),$(".form-inner-wrapper").removeClass().addClass("form-inner-wrapper"))}function animateShowForm(){formInitial(),$(".app-mask").show(),$(".form-outter-wrapper").css({display:"block"}).animate({left:"7.5%"},{duration:400,easing:"easeInOutQuart"})}$(function(){$("body").on("click","div.diagnose",animateShowForm),$(".mobile-diagnose").click(function(){$(".mobile-form-outter-wrapper").show()}),$(window).resize(function(){viewport().width>=768&&$(".mobile-form-outter-wrapper").hide()}),$(".mobile-close-button").click(function(){$(".mobile-form-outter-wrapper").hide()}),$(".close-button").click(function(){$(".form-outter-wrapper").removeAttr("style"),$(".form-outter-wrapper").removeClass().addClass("form-outter-wrapper"),$(".form-inner-wrapper").removeAttr("style"),$(".form-inner-wrapper").removeClass().addClass("form-inner-wrapper"),$(".app-mask").removeClass().addClass("app-mask").hide(),$(".contract-context").removeClass().addClass("contract-context"),$(".contract-context").removeAttr("style"),$("#doctor-checkbox").attr("checked",!1),$(".optional-checkbox").removeAttr("style"),$(".doctor-group").removeAttr("style")}),$(".form-feedback-btn").click(function(){$(".close-button").trigger("click"),$(".form-feedback-wrapper").removeAttr("style")}),$(window).resize(function(){setTimeout(resizeForm,0)})}),$(function(){function e(e){r.removeClass("current").eq(e).addClass("current"),o.removeClass("completed").each(function(t){e>t&&$(this).addClass("completed")}),o.removeClass("current").eq(e).addClass("current"),$(".form-navigation .back-to-home").toggle(0===e),$(".form-navigation .previous").toggle(e>0);var t=e>=r.length-1;$(".form-navigation .next").toggle(!t),$(".form-navigation [type=submit]").toggle(t),$(".checkbox-wrapper").toggle(t);var a=$("html, body"),i=$(".form-wrapper").offset().top;a.stop().animate({scrollTop:i},"1000","easeOutCubic")}function t(){return r.index(r.filter(".current"))}var r=$(".form-section"),o=$(".form-step-indicator span");$(".form-navigation .previous").click(function(){$(".contract-context").removeAttr("style").removeClass("show"),e(t()-1)}),$(".form-navigation .next").click(function(){r.filter(".current").find("input, select").valid()&&e(t()+1)}),$(".form-navigation .back-to-home").click(function(){$(".form-outter-wrapper").removeAttr("style"),$(".form-outter-wrapper").removeClass().addClass("form-outter-wrapper"),$(".form-inner-wrapper").removeAttr("style"),$(".form-inner-wrapper").removeClass().addClass("form-inner-wrapper"),$(".app-mask").removeClass().addClass("app-mask").hide(),$(".contract-context").removeClass().addClass("contract-context"),$("#doctor-checkbox").attr("checked",!1),$(".optional-checkbox").removeAttr("style"),$(".doctor-group").removeAttr("style")}),$(".btn-medical").click(function(){$(".form-inner-wrapper").addClass("form-show"),$(".change-label").text("请详细描述您的情况和需求"),e(0)}),$(".btn-expert").click(function(){$(".app-mask").addClass("expert-mask"),$(".form-inner-wrapper").addClass("form-show-expert"),$("#form-type").val(1),$(".optional-checkbox").css("display","block"),$(".change-label").text("请简要说明您的病情，并描述你想要从医疗专家意见书中得知什么")}),$(".btn-health").click(function(){$(".app-mask").addClass("health-mask"),$(".form-inner-wrapper").addClass("form-show-health"),$(".contract-context").addClass("contract-context2"),$("#form-type").val(2)}),$(".btn-pressure").click(function(){$(".app-mask").addClass("pressure-mask"),$(".form-inner-wrapper").addClass("form-show-pressure"),$(".contract-context").addClass("contract-context3"),$("#form-type").val(3)}),$(".btn-resource").click(function(){$(".app-mask").addClass("resource-mask"),$(".form-inner-wrapper").addClass("form-show-resource"),$(".contract-context").addClass("contract-context4"),$("#form-type").val(4)}),$("#dtBox").DateTimePicker({language:"zh-CN",addEventHandlers:function(){var e=this;e.settings.minDate=e.getDateTimeStringInFormat("Date","yyyy-MM-dd",new Date(1890,1,1)),e.settings.maxDate=e.getDateTimeStringInFormat("Date","yyyy-MM-dd",new Date)}}),$(".relation-between").click(function(){$("#is-patient-self1").is(":checked")?($("#other-relation").prop("disabled",!0),$("#other-relation").val("0"),$("#other-relation").addClass("not-mandatory")):$("#is-patient-self2").is(":checked")&&($("#other-relation").prop("disabled",!1),$("#other-relation").removeClass("not-mandatory"))}),$("#province, #city").citylist({data:data,id:"id",children:"cities",name:"name",metaTag:"name"}),$("#province2, #city2").citylist({data:data,id:"id",children:"cities",name:"name",metaTag:"name"});var a=$(".form-wrapper");$(".contract-click").on("click",function(e){var t=a.offset(),r=a.width(),o=$(".checkbox-wrapper").offset(),i=$(".contract-context").height();viewport().width>768&&$(".contract-context").css({"margin-left":"-15px",width:r+30+"px",left:t.left+"px",top:o.top-30-i}),$(".contract-context").show().addClass("show")}),$(window).resize(function(){var e=$(".form-wrapper");if(e.length>0){var t=e.offset(),r=e.width(),o=$(".checkbox-wrapper").offset(),a=$(".contract-context").height();viewport().width>768&&$(".contract-context").css({"margin-left":"-15px",width:r+30+"px",left:t.left+"px",top:o.top-30-a})}}),$(".contract-close-button").click(function(){$(".contract-context").removeClass("show"),$(".contract-context").removeAttr("style").hide()}),$(".optional-checkbox").click(function(){$("#doctor-checkbox").is(":checked")?$(".doctor-group").css("display","block"):$(".doctor-group").removeAttr("style")});var i=$(".input-file");i.each(function(){var e=$(this).next("label");$(this).on("change",function(t){var r=$(this).val().split("\\").pop();r?e.find(".file-name").html(r).css({display:"inline-block"}):e.find(".file-name").removeAttr("style")})}),$("#contract-para").perfectScrollbar(),Ps.initialize(document.getElementById("contract-para"))}),$(function(){$(".medical-form").validate({rules:{"patient-name":{required:!0},"patient-birth":{required:!0,date:!0},"patient-gender":{required:!0},"other-relation":{valueNotEquals:"0"},"applicant-name":{required:!0},province:{valueNotEquals:"省"},"address-details":{required:!0},"user-zip":{required:!0},"user-first-phone":{required:!0},"user-email":{required:!0,email:!0},"user-time":{required:!0},"aux-file":{extension:"jpg|png|bmp|doc|docx|pdf|txt",filesize:3e3},"contract-checkbox":{required:!0}},messages:{"patient-name":{required:"此项为必填项"},"patient-birth":{required:"此项为必填项",date:"请填写正确的日期格式"},"patient-gender":{required:"此项为必填项"},"other-relation":{valueNotEquals:"此项为必填项"},"applicant-name":{required:"此项为必填项"},province:{valueNotEquals:"此项为必填项"},"address-details":{required:"此项为必填项"},"user-zip":{required:"此项为必填项"},"user-first-phone":{required:"此项为必填项"},"user-email":{required:"此项为必填项",email:"请填写合法的email地址"},"user-time":{required:"此项为必填项"},"aux-file":{extension:"文件格式不符合要求",filesize:"文件大小应小于3KB"},"contract-checkbox":{required:"请接受服务条款"}},errorPlacement:function(e,t){if("aux-file"==t.attr("name"))e.appendTo(".file-error");else if("patient-gender"==t.attr("name"))e.appendTo(".gender-error");else if("contract-checkbox"==t.attr("name"))e.appendTo(".contract-check-error");else{if("user-time"!=t.attr("name"))return!1;e.appendTo(".user-time-error")}}}),$.validator.addMethod("valueNotEquals",function(e,t,r){return $(t).hasClass("not-mandatory")?!0:r!=e}),$.validator.addMethod("extension",function(e,t,r){return r="string"==typeof r?r.replace(/,/g,"|"):"png|jpe?g|gif",this.optional(t)||e.match(new RegExp("\\.("+r+")$","i"))}),$.validator.addMethod("filesize",function(e,t,r){return this.optional(t)||t.files[0].size<=r})}),$(function(){$(".medical-form").submit(function(e){if(e.preventDefault(),!$(".contract-context").hasClass("show")&&$(".medical-form").valid()){$(".medical-form").find("input[type=submit]").prop("disabled",!0);var t=$(".medical-form").serialize();$.ajax({url:"/case/save",type:"POST",data:JSON.stringify(t),success:function(){$(".form-feedback-wrapper").show()},complete:function(){$(".medical-form").find("input[type=submit]").prop("disabled",!1)}}),console.log(JSON.stringify(t))}})});